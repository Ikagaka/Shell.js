(function(global){
'use strict';(function(e){function b(){this.c={}}function l(a){return e.Event?new e.Event(a):{type:a,target:null,currentTarget:null,bubbles:!1,cancelable:!1,defaultPrevented:!1,eventPhase:0,timeStamp:Date.now()}}b.prototype={constructor:b,register:function(){return this},list:function(a){return this.has(a)?this.c[a]:[]},has:function(a){return a in this.c},on:function(a,c,f){this.has(c)?this.c[c].push(f):this.c[c]=[f];a&&a.addEventListener(c,f,!1);return this},off:function(a,c,f){if(this.has(c)){var k=
this.c[c].indexOf(f);0<=k&&(this.c[c].splice(k,1),this.c[c].length||delete this.c[c])}a&&a.removeEventListener(c,f,!1);return this},fire:function(a,c){a&&a.dispatchEvent?a.dispatchEvent(l(c)):this.has(c)&&this.c[c].forEach(function(a){a(l(c))})},clear:function(a){for(var c in this.c)for(var f=this.c[c],k=0,d=f.length;k<d;++k)a&&a.removeEventListener(c,f[k],!1);this.c={};return this}};"process"in e&&(module.exports=b);e["WMEvent"in e?"WMEvent_":"WMEvent"]=b})((this||0).self||global);
(function(e){function b(){}function l(a,c,f,k){if(c&&k>c)throw new TypeError("DataCloneError: "+a);if(null===a||void 0===a)return a;var d=Object.prototype.toString.call(a).split(" ")[1].slice(0,-1);switch(d){case "Function":return a;case "String":case "Number":case "Boolean":return a.valueOf();case "RegExp":return RegExp(a.source,(a+"").slice(a.source.length+2));case "Date":return new Date(+a);case "Array":d=[];d.length=a.length;for(var h=0,b=a.length;h<b;++h)h in a&&(d[h]=l(a[h],c,f,k+1));return d;
case "Object":for(var d={},h=Object.keys(a),b=0,p=h.length;b<p;++b){var m=h[b];d[m]=l(a[m],c,f,k+1)}return d;case "Error":return new a.constructor(a.message);case "Uint8ClampedArray":case "Uint8Array":case "Uint16Array":case "Uint32Array":case "Int8Array":case "Int16Array":case "Int32Array":case "Float32Array":case "Float64Array":return new e[d](a.buffer.slice(0))}if(a.nodeType)a=a.cloneNode(!0);else if(a instanceof e.NamedNodeMap){c={};for(f=0;k=a[f++];)c[k.name]=k.value;a=c}else if(a instanceof
e.CSSStyleDeclaration){c={};d=0;for(h=a.length;d<h;++d)f=a.item(d),(k=a[f])&&"string"===typeof k&&(c[f]=k);a=c}else if("length"in a&&"function"===typeof a.item){d=[];h=0;for(b=a.length;h<b;++h)d[h]=l(a[h],c,f,k+1);a=d}else a=f?f(a,c,f,k):a;return a}b.array={toString:function(a){if(!a)return"";var c=[],f=0,b=a.length,d=Array.isArray(a)?"slice":"subarray";if(32E3>b)return String.fromCharCode.apply(null,a);for(;f<b;f+=32E3)c.push(String.fromCharCode.apply(null,a[d](f,f+32E3)));return c.join("")},fromString:function(a,
c){for(var f=0,b=a.length,d=Array(b),h=Math.pow(256,c||1)-1;f<b;++f)d[f]=a.charCodeAt(f)&h;return d},clampValue:function(a,c){for(var f=0,b=a.length,d=0,h=Math.pow(256,c||1)-1;f<b;++f)d=a[f],a[f]=0>d?0:d>h?h:d;return a},toHexStringArray:function(a,c,f){var b=[],d=0,h=a.length;f=-(2*(f||1));if(c)for(c=/\w/;d<h;++d){var e=String.fromCharCode(a[d]);c.test(e)?b.push(e):b.push("%"+(a[d]+4294967296).toString(16).slice(f))}else for(;d<h;++d)b.push((a[d]+4294967296).toString(16).slice(f));return b}};b.uint8array=
{clone:function(a,c,b){return void 0!==b?new Uint8Array(a.buffer.slice(c,b)):new Uint8Array(a.buffer.slice(c||0))},concat:function(){for(var a=arguments,c=0,b=a.length,e=0,d=0;c<b;++c)e+=a[c].length;e=new Uint8Array(e);for(c=0;c<b;++c)e.set(a[c],d),d+=a[c].length;return e},toArray:function(a){return Array.prototype.slice.call(a)},fromString:function(a){for(var c=0,b=a.length,e=new Uint8Array(b);c<b;++c)e[c]=a.charCodeAt(c)&255;return e}};b.object={clone:function(a,b,e){return l(a,b||0,e,0)}};b.Array=
b.array;b.Object=b.object;b.Uint8Array=b.uint8array;"process"in e&&(module.exports=b);e["DataType"in e?"DataType_":"DataType"]=b})((this||0).self||global);
(function(e){function b(a){return b.parse(a)}function l(t){return a(t,!1)||{href:t}}function a(a,b){var g=v.exec(a);return g?b&&!c(g[3])?null:f({href:a,protocol:g[1]||"",hostname:g[2]||"",port:"",pathname:g[3]||"",search:g[4]||"",hash:g[5]||""},["",""]):(g=m.exec(a))?b&&(/[^A-Za-z0-9\+\-\.\:]/.test(g[1])||/^[0-9]/.test(g[1])||/[^\:]$/.test(g[1])||!c(g[5]||""))?null:f({href:a,protocol:g[1],hostname:g[3],port:g[4]?g[4]:p[g[1]]||"",pathname:g[5]||"",search:g[6]||"",hash:g[7]||""},(g[2]||":").split(":")):
(g=y.exec(a))?b&&!c(g[1])?null:f({href:a,protocol:"",hostname:"",port:"",pathname:g[1]||"",search:g[2]||"",hash:g[3]||""},["",""]):null}function c(a){return a&&(/\/\//.test(a)||/[^\/\w\-\.\~\%\!\$\&\'\(\)\*\+,;\=\:@]/.test(a))?!1:!0}function f(a,b){var g=a.port?a.hostname+":"+a.port:a.hostname;a.origin=a.protocol?a.protocol+"//"+g:g;a.host=g;a.username=b[0];a.password=b[1];var c=a.pathname.split("/"),g=c.pop(),c=c.join("/");a.scheme=a.protocol;a.path=a.pathname+a.search;a.dir=c;a.file=g;a.fragment=
a.hash;return a}function k(a){var b=a.protocol||a.sceheme||"",c=a.username||"",d=a.password||"",e=a.hostname||"",f=a.pathname||"/",h=a.port||"",k=a.search||"",n=a.hash||a.fragment||"",l="",m="";b&&(l="//",e||(l+="/"));a.auth?m=a.auth+"@":c&&d&&(m=c+":"+d+"@");b&&p[b]!==h||(h="");return[b,l,m,e,h?":"+h:h,f,k,n].join("")}function d(a){a=l(a);var b=a.dir.split("/").reduce(function(a,b){".."===b?(a.pop(),a.length||a.unshift("/")):/^\.+$/.test(b)||a.push(b);return a},[]).join("/");a.pathname=(b+"/").replace(/\/+/g,
"/")+a.file;return k(a)}function h(a){return/^(https?|wss?):/.test(a)?m.test(a):v.test(a)}var n="document"in e,p={"http:":"80","https:":"443","ws:":"81","wss:":"816"},m=/^([\w\+\-\.]+:)\/\/(?:(?:([\w:]+)@)?([^\/:]+)(?::(\d*))?)([^ :?#]*)(?:(\?[^#]*))?(?:(#.*))?$/,v=/^(file:)\/\/(localhost)?([^ ?#]*)(?:(\?[^#]*))?(?:(#.*))?$/i,y=/^([^ ?#]*)(?:(\?[^#]*))?(?:(#.*))?$/,r=+(""+Date.now()).slice(-4),z=n?location.href.slice(0,location.href.lastIndexOf("/")):"";b.isValid=function(b){b=Array.isArray(b)?b:
[b];for(var c=0,d=b.length;c<d;++c)if(!a(b[c],!0))return!1;return!0};b.parse=l;b.build=k;b.match=function(a,b){var c=l(a).path.replace(/^\.\//,""),d=l(b).path.replace(/^\.\//,""),c=c.replace(/\./g,function(){return"\\."}).replace(/\*\*/g,function(){return"[-\\w\\.%()\\/]+"}).replace(/\*/g,function(){return"[-\\w\\.%()]+"});return RegExp("^"+c+"$").test(d)};b.resolve=function(a,b){return h(a)?a:b?d(b+"/"+a):n?d(z+"/"+a):a};b.normalize=d;b.isAbsolute=h;b.isRelative=function(a){return m.test("http://example.com/"+
a.replace(/^\/+/,""))};b.buildQuery=function(a,b){b=b||"&";var c=[],d;for(d in a){var f=e.encodeURIComponent(d),h=a[d];Array.isArray(h)||(h=[h]);for(var k=[],n=0,l=h.length;n<l;++n)k.push(f+"="+e.encodeURIComponent(h[n]));c.push(k.join(b))}return c.join(b)};b.parseQuery=function(a){var b={};0<=a.indexOf("?")&&(a=a.split("?")[1].split("#")[0]);a.replace(/&amp;|&|;/g,";").replace(/(?:([^\=]+)\=([^\;]+);?)/g,function(a,c,d){a=e.encodeURIComponent(c);d=e.encodeURIComponent(d);b[a]?Array.isArray(b[a])?
b[a].push(d):b[a]=[b[a],d]:b[a]=d;return""});return b};b.addCacheBustingKeyword=function(b,c){c=(c||"t")+"=";if(0<=b.indexOf("#")){var d=a(b);d.search=d.search.length?d.search+("&"+c+ ++r):d.search+("?"+c+ ++r);b=k(d)}else b=0<=b.indexOf("?")?b+("&"+c+ ++r):b+("?"+c+ ++r);return b};"process"in e&&(module.exports=b);e["WMURL"in e?"WMURL_":"WMURL"]=b})((this||0).self||global);
(function(e){function b(){this.d=(new K).register(M);this.a=null;this.b=q;e.XMLHttpRequest?(this.b=w,this.a=new XMLHttpRequest,"onload"in this.a&&"responseType"in this.a&&"withCredentials"in this.a&&(this.b=s)):this.a={readyState:x,method:"",url:"",async:!0,auth:"",requestHeader:{},response:null,responseText:"",responseXML:null,responseHeaders:{},status:0,statusText:"",upload:null,withCredentials:!1};this.f="";this.e=x;Object.defineProperties(this,{readyState:{get:l},response:{get:a},responseText:{get:c},
responseType:{get:f,set:k},responseXML:{get:d},status:{get:h},statusText:{get:n},upload:{get:p,set:m},withCredentials:{get:v,set:y}})}function l(){return this.a.readyState}function a(){return this.a.response}function c(){return this.a.responseText}function f(){return this.a.responseType}function k(a){if(G(a))this.a.responseType=a;else throw new TypeError("Unsupported responseType: "+a);}function d(){return this.a.responseXML}function h(){return this.a.status}function n(){return this.a.statusText}
function p(){return this.a.upload||null}function m(a){this.a.upload=a}function v(){return this.a.withCredentials||!1}function y(a){this.a.withCredentials=a}function r(a,b){N.get(b,function(b){b.setEncoding("utf8");a.handleEvent();a.a.readyState=A;a.a.responseHeaders=b.headers;a.a.status=b.statusCode;a.handleEvent();a.a.readyState=B;a.handleEvent();b.on("data",function(b){a.a.responseText+=b;a.handleEvent()});b.on("end",function(){a.a.readyState=u;a.handleEvent()})}).on("error",function(b){a.a.readyState=
u;a.a.statusText=b.message;a.a.status=400;a.handleEvent();g(a,"error")})}function z(a,b){function c(b){a.a.readyState=u;a.a.status=b||400;a.handleEvent();g(a,"error")}E.existsSync(b)?E.readFile(b,{encoding:"utf8"},function(b,d){b?c(400):(a.handleEvent(),a.a.readyState=A,a.a.responseHeaders={},a.a.status=200,a.handleEvent(),a.a.readyState=B,a.handleEvent(),a.a.responseText=d,a.a.readyState=u,a.handleEvent())}):c(404)}function t(a,b){this.d.on(this.b===s?this.a:null,a,b);return this}function C(a,b){this.d.off(this.b===
s?this.a:null,a,b);return this}function g(a,b,c){c=c||{type:b};a.d.has(b)&&a.d.list(b).forEach(function(b){b.call(a.a,c)})}function F(a,b){switch(b){case "json":return JSON.parse(a);case "document":var c;I?(c=document.createElement("body"),c.innerHTML=a):c=a;return c;case "arraybuffer":case "blob":return L.Array.fromString(a)}return a}function D(a,b){var c=200<=a&&300>a;return b?0===a||c:c}function G(a){switch(a){case "arraybuffer":return!!e.ArrayBuffer;case "blob":return!!e.Blob;case "document":return!!e.HTMLDocument;
case "text":return!0;case "json":return!0}return!1}var H="process"in e,I="document"in e,J=e.WMURL||require("uupaa.wmurl.js"),K=e.WMEvent||require("uupaa.wmevent.js"),L=e.DataType||require("uupaa.datatype.js");if(H)var N=require("http"),E=require("fs");var x=0,A=2,B=3,u=4,q=0,w=1,s=2,M="loadstart load loadend progress readystatechange error timeout".split(" ");b.get=function(a,c,d){d=d||{};d=d.responseType||"text";var e=new b;e.on("load",function(){D(this.status,/^file\:/.test(a))?c.call(this,null,
this.response||this.responseText):c.call(this,Error(this.status),"")});d&&"text"!==d&&(e.responseType=d);e.open("GET",a);e.send()};b.prototype={constructor:b,getAllResponseHeaders:function(){if(this.b>q)return this.a.getAllResponseHeaders();var a=this.a.responseHeaders;return Object.keys(a).map(function(b){return b+":"+a[b]}).join("\n")},getResponseHeader:function(a){return this.b>q?this.a.getResponseHeader(a):this.a.responseHeaders[a]},open:function(a,b,c,d,e){c=void 0===c?!0:c;this.f=b;this.e=x;
switch(this.b){case q:this.a.method=a;this.a.url=b;this.a.async=c;this.a.auth=d&&e?d+":"+e:"";this.a.readyState===x&&(this.a.status=0,this.a.responseText="",g(this,"readystatechange"),this.a.readyState=1);break;case w:this.a.addEventListener("readystatechange",this);this.a.open(a,b,c,d,e);break;case s:this.a.open(a,b,c,d,e)}},overrideMimeType:function(a){this.b>q&&this.a.overrideMimeType(a)},send:function(a){switch(this.b){case q:a=J.parse(this.a.url);var b=a.username||"",c=a.password||"",b={host:a.hostname,
port:a.port||80,path:a.path,g:this.a.auth||(b&&c?b+":"+c:"")||"",h:this.a.method,headers:this.a.requestHeader};a.host?r(this,b):z(this,a.pathname);break;case w:/arraybuffer|blob/.test(this.a.responseType)&&this.a.overrideMimeType("text/plain; charset=x-user-defined");this.a.send(a);break;case s:this.a.send(a)}},setRequestHeader:function(a,b){this.b===q?this.a.requestHeader[a.toLowerCase()]=b:this.a.setRequestHeader(a,b)},addEventListener:t,removeEventListener:C,on:t,off:C,clear:function(){this.d.clear(this.b===
s?this.a:null);return this},abort:function(){this.a.abort()},getLevel:function(){return this.b},handleEvent:function(a){var b=this.a,c=b.status,d=b.readyState;this.e!==d&&(this.e=d,g(this,"readystatechange",a));switch(d){case 1:g(this,"loadstart",a);break;case A:g(this,"progress",a);break;case B:g(this,"progress",a);break;case u:if(D(c,/^file\:/.test(this.f))){try{b.response=F(b.responseText,b.responseType)}catch(e){}g(this,"load",a)}g(this,"loadend",a);this.b===w&&b.removeEventListener("readystatechange",
this)}}};"process"in e&&(module.exports=b);e["XHRProxy"in e?"XHRProxy_":"XHRProxy"]=b})((this||0).self||global);
(function(e){function b(a){a=a||{};this.retryCount=0;this.maximumRetryCount=a.maximumRetryCount||10}function l(a,b){var e=new f,p=l.bind(this,a,b);e.on("load",c(this,e,p,function(a){if(a)return b(a,"");b(null,e.response.id)}));e.open("POST","https://www.googleapis.com/urlshortener/v1/url",!0);e.setRequestHeader("Content-Type","application/json");e.responseType="json";e.send(k.stringify({longUrl:a}))}function a(b,e){var k=new f,l=a.bind(this,b,e);k.on("load",c(this,k,l,function(a){if(a)return e(a,
"");e(null,k.response.longUrl)}));k.open("GET","https://www.googleapis.com/urlshortener/v1/url?shortUrl="+b);k.responseType="json";k.send()}function c(a,b,c,e){return function(){if(200<=b.status&&300>b.status)"undefined"===typeof b.response.error?e(null):e(Error(b.response.error.message));else if(403===b.status&&a.retryCount<a.maximumRetryCount){a.retryCount++;var f=3*Math.pow(2,a.retryCount);console.info(b.status+": retrying "+f+"ms after... "+a.retryCount+"/"+a.maximumRetryCount);setTimeout(c,f)}else e(Error(b.status))}}
var f=e.XHRProxy||require("uupaa.xhrproxy.js"),k=e.JSON;b.prototype.shorten=l;b.prototype.expand=a;"process"in e&&(module.exports=b);e["WMURLShortener"in e?"WMURLShortener_":"WMURLShortener"]=b})((this||0).self||global);
})((this||0).self||global);
